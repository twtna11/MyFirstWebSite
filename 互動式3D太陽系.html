<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D å¤ªé™½ç³»äº’å‹•æ¨¡æ“¬</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; }
        canvas { display: block; }
        
        #ui-container {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            z-index: 10;
            pointer-events: none; /* è®“é»æ“Šç©¿é€åˆ° canvas */
        }
        
        h1 { margin: 0; text-shadow: 0 0 10px #00d2ff; font-size: 24px; }
        p { margin: 5px 0; font-size: 14px; opacity: 0.8; }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
            display: flex;
            gap: 15px;
        }

        button {
            background: rgba(0, 200, 255, 0.2);
            border: 1px solid rgba(0, 200, 255, 0.5);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        button:hover {
            background: rgba(0, 200, 255, 0.6);
            transform: scale(1.05);
        }

        button.active {
            background: #00d2ff;
            color: black;
            font-weight: bold;
        }

        #info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 250px;
            background: rgba(10, 20, 40, 0.85);
            border: 1px solid #336699;
            padding: 20px;
            border-radius: 10px;
            color: white;
            transform: translateX(120%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
        }

        #info-panel.visible {
            transform: translateX(0);
        }

        .planet-name {
            font-size: 22px;
            font-weight: bold;
            border-bottom: 2px solid #00d2ff;
            padding-bottom: 5px;
            margin-bottom: 10px;
            color: #00d2ff;
        }

        .planet-data {
            font-size: 14px;
            line-height: 1.6;
            color: #ccc;
        }

        .label {
            color: #aaa;
            font-size: 12px;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 20px;
            z-index: 100;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
    </style>
    <!-- å¼•å…¥ Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

    <div id="loading">è¼‰å…¥æ˜Ÿç³»ä¸­...</div>

    <div id="ui-container">
        <h1>ğŸŒŒ 3D å¤ªé™½ç³»æ¢ç´¢</h1>
        <p>æ‹–æ›³æ—‹è½‰ â€¢ æ»¾è¼ªç¸®æ”¾ â€¢ é»æ“Šè¡Œæ˜ŸæŸ¥çœ‹è©³æƒ…</p>
    </div>

    <div id="info-panel">
        <div id="panel-content">
            <div class="planet-name">åœ°çƒ</div>
            <div class="planet-data">æˆ‘å€‘å±…ä½çš„æ˜Ÿçƒï¼Œå¤ªé™½ç³»ä¸­å”¯ä¸€å·²çŸ¥å­˜åœ¨ç”Ÿå‘½çš„è¡Œæ˜Ÿã€‚</div>
        </div>
        <button onclick="closePanel()" style="margin-top: 15px; width: 100%;">é—œé–‰</button>
    </div>

    <div id="controls">
        <button id="btn-pause">æš«åœ</button>
        <button id="btn-speed-1" class="active">1x é€Ÿåº¦</button>
        <button id="btn-speed-10">10x é€Ÿåº¦</button>
        <button id="btn-reset">é‡ç½®è¦–è§’</button>
    </div>

    <script>
        // --- è¨­å®šå ´æ™¯è®Šæ•¸ ---
        let scene, camera, renderer, controls;
        let planets = [];
        let orbits = [];
        let speedMultiplier = 1;
        let isPaused = false;
        let raycaster, mouse;
        
        // ç‚ºäº†è¦–è¦ºæ•ˆæœï¼Œæˆ‘å€‘èª¿æ•´äº†æ¯”ä¾‹ï¼ˆéçœŸå¯¦å¤©æ–‡æ¯”ä¾‹ï¼‰
        // è·é›¢å–®ä½ç¶“éå£“ç¸®ï¼Œè¡Œæ˜Ÿå¤§å°ç¶“éæ”¾å¤§ä»¥ä¾¿è§€å¯Ÿ
        const planetData = [
            { name: "æ°´æ˜Ÿ", size: 0.8, distance: 20, speed: 0.02, color: "#A9A9A9", type: "noise", desc: "æœ€é è¿‘å¤ªé™½çš„è¡Œæ˜Ÿï¼Œè¡¨é¢å……æ»¿å‘æ´ï¼Œæ—¥å¤œæº«å·®æ¥µå¤§ã€‚" },
            { name: "é‡‘æ˜Ÿ", size: 1.5, distance: 30, speed: 0.015, color: "#E6C229", type: "cloud", desc: "å¤ªé™½ç³»ä¸­æœ€ç†±çš„è¡Œæ˜Ÿï¼Œæ“æœ‰æ¿ƒåšçš„å¤§æ°£å±¤å’Œç¡«é…¸é›²ã€‚" },
            { name: "åœ°çƒ", size: 1.6, distance: 45, speed: 0.01, color: "#2233FF", type: "earth", desc: "æˆ‘å€‘çš„å®¶åœ’ï¼Œè¡¨é¢è¦†è“‹è‘—70%çš„æµ·æ´‹ï¼Œæ“æœ‰é©åˆç”Ÿå‘½çš„å¤§æ°£ã€‚" },
            { name: "ç«æ˜Ÿ", size: 1.2, distance: 60, speed: 0.008, color: "#C1440E", type: "noise", desc: "ç´…è‰²çš„æ˜Ÿçƒï¼Œæ“æœ‰å¤ªé™½ç³»æœ€é«˜çš„ç«å±±â€”å¥§æ—å¸•æ–¯å±±ã€‚" },
            { name: "æœ¨æ˜Ÿ", size: 5.5, distance: 90, speed: 0.004, color: "#D8CA9D", type: "striped", desc: "å¤ªé™½ç³»æœ€å¤§çš„è¡Œæ˜Ÿï¼Œå·¨å¤§çš„æ°£æ…‹å·¨è¡Œæ˜Ÿï¼Œæ“æœ‰è‘—åçš„å¤§ç´…æ–‘ã€‚" },
            { name: "åœŸæ˜Ÿ", size: 4.5, distance: 130, speed: 0.003, color: "#F4D03F", type: "ringed", desc: "ä»¥å…¶å£¯è§€çš„è¡Œæ˜Ÿç’°èåï¼Œæ˜¯ä¸€é¡†å¯†åº¦æ¯”æ°´é‚„ä½çš„æ°£æ…‹å·¨è¡Œæ˜Ÿã€‚" },
            { name: "å¤©ç‹æ˜Ÿ", size: 3.0, distance: 170, speed: 0.002, color: "#73ACAC", type: "solid", desc: "èººè‘—è‡ªè½‰çš„å†°å·¨è¡Œæ˜Ÿï¼Œå‘ˆç¾ç¨ç‰¹çš„è—ç¶ è‰²ã€‚" },
            { name: "æµ·ç‹æ˜Ÿ", size: 2.8, distance: 200, speed: 0.0015, color: "#5B5DD1", type: "solid", desc: "è·é›¢å¤ªé™½æœ€é çš„è¡Œæ˜Ÿï¼Œæ“æœ‰å¤ªé™½ç³»æœ€å¼·çƒˆçš„é¢¨æš´ã€‚" }
        ];

        // åˆå§‹åŒ–
        function init() {
            // 1. å ´æ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);
            scene.fog = new THREE.FogExp2(0x000000, 0.002);

            // 2. ç›¸æ©Ÿ
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 80, 150);

            // 3. æ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // 4. æ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxDistance = 400;

            // 5. ç‡ˆå…‰
            // å¤ªé™½å…‰ (é»å…‰æº)
            const sunLight = new THREE.PointLight(0xffffff, 1.5, 400);
            sunLight.position.set(0, 0, 0);
            scene.add(sunLight);

            // ç’°å¢ƒå…‰ (è®“èƒŒå…‰é¢ä¸è‡³æ–¼å…¨é»‘)
            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);

            // 6. (å·²ç§»é™¤æ˜Ÿç©ºèƒŒæ™¯)
            // createStars(); 

            // 7. å»ºç«‹å¤ªé™½
            createSun();

            // 8. å»ºç«‹è¡Œæ˜Ÿ
            planetData.forEach(createPlanet);

            // 9. äº’å‹•è¨­å®š
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            window.addEventListener('click', onMouseClick, false);
            window.addEventListener('resize', onWindowResize, false);

            // 10. é–‹å§‹å‹•ç•«
            animate();
        }

        // --- è¼”åŠ©å‡½æ•¸ï¼šç”Ÿæˆç´‹ç† ---
        // ç‚ºäº†ä¸ä¾è³´å¤–éƒ¨åœ–ç‰‡é€£çµï¼Œæˆ‘å€‘ç”¨ Canvas å‹•æ…‹ç•«å‡ºæ˜Ÿçƒç´‹ç†
        function createTexture(type, colorHex) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 256; // å¯¬é«˜æ¯” 2:1
            const ctx = canvas.getContext('2d');
            const color = new THREE.Color(colorHex);

            // å¡«æ»¿åº•è‰²
            ctx.fillStyle = colorHex;
            ctx.fillRect(0, 0, 512, 256);

            if (type === 'noise' || type === 'earth') {
                // å¢åŠ å™ªé»
                for (let i = 0; i < 2000; i++) {
                    const x = Math.random() * 512;
                    const y = Math.random() * 256;
                    const r = Math.random() * 5 + 1;
                    ctx.beginPath();
                    ctx.arc(x, y, r, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, 0.15)`;
                    ctx.fill();
                }
            }
            
            if (type === 'earth') {
                // ç•«ä¸€äº›ç¶ è‰²å¤§é™¸å¡Š
                ctx.fillStyle = '#2d8f38'; 
                for (let i=0; i<10; i++) {
                     ctx.beginPath();
                     ctx.arc(Math.random()*512, Math.random()*256, Math.random()*50 + 20, 0, Math.PI*2);
                     ctx.fill();
                }
                // å¤§æ°£é›²å±¤
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                for (let i=0; i<5; i++) {
                    ctx.fillRect(0, Math.random()*256, 512, Math.random()*20);
                }
            }

            if (type === 'striped' || type === 'ringed') {
                // ç•«æ¢ç´‹ (æœ¨æ˜Ÿ/åœŸæ˜Ÿ)
                for (let i = 0; i < 20; i++) {
                    const y = Math.random() * 256;
                    const h = Math.random() * 20 + 5;
                    ctx.fillStyle = i % 2 === 0 ? `rgba(0,0,0,0.1)` : `rgba(255,255,255,0.1)`;
                    ctx.fillRect(0, y, 512, h);
                }
            }

            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        // function createStars() { ... } // ç§»é™¤äº†èƒŒæ™¯æ˜Ÿç©ºç”Ÿæˆå‡½æ•¸

        function createSun() {
            const geometry = new THREE.SphereGeometry(12, 32, 32);
            // å¤ªé™½è‡ªç™¼å…‰
            const material = new THREE.MeshBasicMaterial({ 
                color: 0xffaa00,
            });
            const sun = new THREE.Mesh(geometry, material);
            
            // å¢åŠ ä¸€å€‹å…‰æšˆå±¤
            const glowGeo = new THREE.SphereGeometry(13, 32, 32);
            const glowMat = new THREE.MeshBasicMaterial({
                color: 0xffaa00,
                transparent: true,
                opacity: 0.3,
                side: THREE.BackSide
            });
            const glow = new THREE.Mesh(glowGeo, glowMat);
            sun.add(glow);

            scene.add(sun);
            
            // è®“ Raycaster å¯ä»¥åµæ¸¬åˆ°å¤ªé™½
            sun.userData = { name: "å¤ªé™½", desc: "å¤ªé™½ç³»çš„ä¸­å¿ƒæ†æ˜Ÿï¼Œæä¾›äº†åœ°çƒç”Ÿå‘½æ‰€éœ€çš„èƒ½é‡ã€‚å®ƒä½”æ“šäº†å¤ªé™½ç³»ç¸½è³ªé‡çš„99.86%ã€‚" };
            planets.push({ mesh: sun, distance: 0, speed: 0, angle: 0 });
        }

        function createPlanet(data) {
            // 1. å»ºç«‹è»Œé“ç·š
            const orbitGeo = new THREE.RingGeometry(data.distance - 0.2, data.distance + 0.2, 128);
            const orbitMat = new THREE.MeshBasicMaterial({ 
                color: 0x444444, 
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.3
            });
            const orbit = new THREE.Mesh(orbitGeo, orbitMat);
            orbit.rotation.x = Math.PI / 2;
            scene.add(orbit);

            // 2. å»ºç«‹è¡Œæ˜Ÿæœ¬é«”
            const geometry = new THREE.SphereGeometry(data.size, 32, 32);
            const texture = createTexture(data.type, data.color);
            const material = new THREE.MeshStandardMaterial({ 
                map: texture,
                roughness: 0.8,
                metalness: 0.1
            });
            
            const planet = new THREE.Mesh(geometry, material);
            
            // å„²å­˜è³‡æ–™ä¾›é»æ“Šä½¿ç”¨
            planet.userData = { name: data.name, desc: data.desc };

            // 3. ç‰¹æ®Šè™•ç†ï¼šåœŸæ˜Ÿç’°
            if (data.type === 'ringed') {
                const ringGeo = new THREE.RingGeometry(data.size * 1.4, data.size * 2.2, 64);
                // ç”Ÿæˆç’°çš„ç´‹ç†
                const ringCanvas = document.createElement('canvas');
                ringCanvas.width = 128; ringCanvas.height = 128;
                const rctx = ringCanvas.getContext('2d');
                rctx.fillStyle = '#CBA';
                rctx.fillRect(0,0,128,128);
                // ç•«ä¸€äº›æ·±è‰²åœ“åœˆæ¨¡æ“¬ç’°çš„é–“éš™
                rctx.strokeStyle = 'rgba(0,0,0,0.5)';
                rctx.beginPath(); rctx.arc(64,64, 40, 0, Math.PI*2); rctx.stroke();
                
                const ringTex = new THREE.CanvasTexture(ringCanvas);
                const ringMat = new THREE.MeshBasicMaterial({ 
                    map: ringTex,
                    color: 0xdddddd, 
                    side: THREE.DoubleSide, 
                    transparent: true, 
                    opacity: 0.8 
                });
                const ring = new THREE.Mesh(ringGeo, ringMat);
                ring.rotation.x = Math.PI / 2;
                planet.add(ring);
            }

            // 4. åŠ å…¥å ´æ™¯ç‰©ä»¶ç¾¤çµ„ (æ–¹ä¾¿ä¹‹å¾Œæ—‹è½‰)
            const planetObj = {
                mesh: planet,
                distance: data.distance,
                speed: data.speed,
                angle: Math.random() * Math.PI * 2 // éš¨æ©Ÿåˆå§‹è§’åº¦
            };

            // 5. ç‰¹æ®Šè™•ç†ï¼šåœ°çƒçš„æœˆäº®
            if (data.name === 'åœ°çƒ') {
                const moonGeo = new THREE.SphereGeometry(0.45, 32, 32);
                const moonTex = createTexture('noise', '#CCCCCC'); // ç°ç™½è‰²
                const moonMat = new THREE.MeshStandardMaterial({ map: moonTex });
                const moon = new THREE.Mesh(moonGeo, moonMat);
                
                moon.userData = { name: "æœˆçƒ", desc: "åœ°çƒå”¯ä¸€çš„å¤©ç„¶è¡›æ˜Ÿï¼Œè¡¨é¢ä½ˆæ»¿æ’æ“Šå‘ï¼Œå½±éŸ¿è‘—åœ°çƒçš„æ½®æ±ã€‚" };
                scene.add(moon); // å°‡æœˆçƒç›´æ¥åŠ å…¥å ´æ™¯ï¼Œä½ç½®åœ¨å‹•ç•«è¿´åœˆä¸­è¨ˆç®—

                // å°‡æœˆçƒè³‡æ–™åŠ å…¥åœ°çƒç‰©ä»¶ä¸­
                planetObj.moon = {
                    mesh: moon,
                    distance: 3.5, // é›¢åœ°çƒçš„è·é›¢
                    speed: 0.05, // æœˆçƒå…¬è½‰é€Ÿåº¦
                    angle: 0
                };
            }

            planets.push(planetObj);
            scene.add(planet);
        }

        // --- å‹•ç•«å¾ªç’° ---
        function animate() {
            requestAnimationFrame(animate);

            if (!isPaused) {
                planets.forEach(p => {
                    if (p.distance > 0) { // æ’é™¤å¤ªé™½
                        // æ›´æ–°è§’åº¦ - é€†æ™‚é‡
                        p.angle -= p.speed * speedMultiplier;
                        
                        // æ›´æ–°è¡Œæ˜Ÿä½ç½®
                        p.mesh.position.x = Math.cos(p.angle) * p.distance;
                        p.mesh.position.z = Math.sin(p.angle) * p.distance;
                        
                        // è¡Œæ˜Ÿè‡ªè½‰
                        p.mesh.rotation.y += 0.01;

                        // æ›´æ–°è¡›æ˜Ÿä½ç½® (ä¾‹å¦‚æœˆçƒ)
                        if (p.moon) {
                            // æœˆçƒå…¬è½‰ (é€†æ™‚é‡)
                            p.moon.angle -= p.moon.speed * speedMultiplier;
                            
                            // æœˆçƒä½ç½® = åœ°çƒä½ç½® + åç§»é‡
                            p.moon.mesh.position.x = p.mesh.position.x + Math.cos(p.moon.angle) * p.moon.distance;
                            p.moon.mesh.position.z = p.mesh.position.z + Math.sin(p.moon.angle) * p.moon.distance;
                            
                            // æœˆçƒè‡ªè½‰
                            p.moon.mesh.rotation.y += 0.005;
                        }

                    } else {
                        // å¤ªé™½è‡ªè½‰
                        p.mesh.rotation.y += 0.002;
                    }
                });
            }

            controls.update();
            renderer.render(scene, camera);
        }

        // --- äº’å‹•åŠŸèƒ½ ---
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMouseClick(event) {
            // è¨ˆç®—æ»‘é¼ åœ¨æ¨™æº–åŒ–è¨­å‚™åæ¨™ (NDC) ä¸­çš„ä½ç½® (-1 åˆ° +1)
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            // å»ºç«‹æ‰€æœ‰å¯é»æ“Šç‰©ä»¶çš„æ¸…å–®
            const interactableObjects = [];
            planets.forEach(p => {
                interactableObjects.push(p.mesh);
                if (p.moon) interactableObjects.push(p.moon.mesh);
            });

            // æª¢æ¸¬äº¤é»
            const intersects = raycaster.intersectObjects(interactableObjects);

            if (intersects.length > 0) {
                const object = intersects[0].object;
                // å¯èƒ½æ˜¯è¡Œæ˜Ÿã€æœˆçƒæˆ–åœŸæ˜Ÿç’°
                const target = object.userData.name ? object : object.parent;
                
                if (target && target.userData.name) {
                    showInfo(target.userData.name, target.userData.desc);
                    controls.target.copy(target.position);
                }
            }
        }

        // --- UI æ§åˆ¶ ---
        const infoPanel = document.getElementById('info-panel');
        const pName = document.querySelector('.planet-name');
        const pData = document.querySelector('.planet-data');

        function showInfo(name, desc) {
            pName.textContent = name;
            pData.textContent = desc;
            infoPanel.classList.add('visible');
        }

        function closePanel() {
            infoPanel.classList.remove('visible');
        }

        // æŒ‰éˆ•äº‹ä»¶ç¶å®š
        document.getElementById('btn-pause').addEventListener('click', function() {
            isPaused = !isPaused;
            this.textContent = isPaused ? "ç¹¼çºŒ" : "æš«åœ";
            this.classList.toggle('active');
        });

        document.getElementById('btn-speed-1').addEventListener('click', function() {
            speedMultiplier = 1;
            updateBtnState(this);
        });

        document.getElementById('btn-speed-10').addEventListener('click', function() {
            speedMultiplier = 10;
            updateBtnState(this);
        });

        document.getElementById('btn-reset').addEventListener('click', function() {
            controls.reset();
            camera.position.set(0, 80, 150);
            controls.target.set(0,0,0);
        });

        function updateBtnState(activeBtn) {
            document.querySelectorAll('#controls button').forEach(b => {
                if (b.id.startsWith('btn-speed')) b.classList.remove('active');
            });
            activeBtn.classList.add('active');
        }

        // å•Ÿå‹•ç¨‹å¼
        init();

    </script>
</body>
</html>